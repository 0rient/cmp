<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>CMP4 WMP视频播放</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
html, body { height:100%; margin:0; padding:0; text-align:center; overflow:hidden; }
</style>
</head>
<body>
<script type="text/javascript" src="http://cmp.cenfun.com/cmp4/cmp.js"></script> 
<script type="text/javascript">
//已经封装好WMP类，也可保存为wmp.js进行调用
if(typeof window.WMP==="undefined") {
	var WMP=window.WMP=new (function(){
		var cmpo,wmpo;
		this.init=function(_cmpo, _wmpo){
			cmpo = _cmpo;
			wmpo = _wmpo;
			cmpo.addEventListener("model_start", "WMP.update");
			cmpo.addEventListener("model_state", "WMP.update");
			cmpo.addEventListener("resize", "WMP.update");
			cmpo.addEventListener("view_fullscreen", "WMP.fullscreen");
			cmpo.parentNode.appendChild(wmpo);
			wmpo.uiMode = "None";
			wmpo.fullScreen = false;
			wmpo.stretchToFit = true;
			wmpo.enableContextMenu = true;
			wmpo.style.position = "absolute";
			this.update();
		};
		this.update = function(data) {
			var display = false;
			var item = cmpo.item();
			if (item && item.type == "wmp") {
				var state = cmpo.config("state");
				if (state == "playing") {
					var is_show = cmpo.skin("media", "display");
					if (is_show) {
						display = true;		
					}
				}
			}
			wmpo.style.visibility = display ? "visible" : "hidden";
			if (display) {
				var tx = 0;
				var ty = 0;
				if (!cmpo.config("video_max")) {
					tx = parseInt(cmpo.skin("media", "x")) + parseInt(cmpo.skin("media.video", "x"));
					ty = parseInt(cmpo.skin("media", "y")) + parseInt(cmpo.skin("media.video", "y"));
				}
				var tw = cmpo.config("video_width");
				var th = cmpo.config("video_height");
				wmpo.style.top = ty + "px";
				wmpo.style.left = tx + "px";
				wmpo.width = tw;
				wmpo.height = th;
				var xywh = tx +","+ ty +","+ tw +","+ th;
			}
		}
		this.fullscreen = function(data) {
			var item = cmpo.item();
			if (item.type == "wmp") {
				wmpo.fullScreen = true;
			}
		}
	})();
}
</script>
<div id="cmp_area" style="position:relative;width:80%;height:600px;margin:0px auto;"></div>
<script type="text/javascript">
var cmpo,wmpo;
//定义getElementById到简便函数$
function $(id) { return document.getElementById(id); }
//cmp回调函数，即cmp第一次加载完成时调用，将对wmp进行初始化操作
function cmp_loaded(key) {
	//获取cmp对象
	cmpo = CMP.get("cmp");
	if (!cmpo) {
		alert("CMP初始化错误");
		return;	
	}
	wmpo = $("WMP_" + key);
	if (!wmpo || typeof WMP === "undefined") {
		alert("WMP初始化错误");
		return;	
	}
	//初始化wmp设置
	WMP.init(cmpo, wmpo);
}



//将cmp放在一个固定容器cmp_area里，便于后面设置位置，宽高都设置成100%，也就是随容器宽高进行改变
//必须把cmp垫底，即设置wmode="opaque"，这样wmp窗口才能覆盖显示在cmp上面
//必须设置api=cmp_loaded回调函数
var htm = CMP.create("cmp", "100%", "100%", "http://cmp.cenfun.com/cmp4/cmp.swf", "api=cmp_loaded", {wmode:"opaque"});
$("cmp_area").innerHTML = htm;


//将内容添加到cmp列表函数
function addToList() {
	var label = $("music_label").value;
	var type = $("music_type").value;
	var src = $("music_src").value;
	var xml = '<list><m type="'+type+'" label="'+label+'" src="'+src+'" /></list>';
	if (cmpo) {
		cmpo.list_xml(xml);
		//发送播放事件
		var len = cmpo.skin("list.tree", "length");
		//如果没有打开的目录，推荐使用var len = cmpo.list().length;
		cmpo.sendEvent("view_play", len);
	}
}
</script>
<div style="margin:10px auto;text-align:left;width:800px;">
  <div>名称：
    <input id="music_label" type="text" value="ChannelV" onclick="this.select();" />
    类型：
    <select id="music_type">
      <option value="">自动识别</option>
      <option value="1">MP3音频</option>
      <option value="2">FLV视频</option>
      <option value="3" selected="selected">WMP类型</option>
      <option value="4">动画图片</option>
    </select>
  </div>
  <div style="margin:5px 0px;">地址：
    <input id="music_src" type="text" style="width:630px;" onclick="this.select();" value="mms://222.77.190.24/ChannelV" />
    wma/wmv/h264</div>
  <div>
    <input type="button" value="添加到列表进行播放" onclick="addToList();" />
  </div>
</div>
</body>
</html>