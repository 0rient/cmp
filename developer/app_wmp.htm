<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>CMP4 WMP视频播放</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
html, body { height:100%; margin:0; padding:0; text-align:center; overflow:hidden; }
</style>
</head>
<body>
<script type="text/javascript" src="http://cmp.cenfun.com/cmp4/cmp.js"></script>
<div id="cmp_area" style="position:relative;width:800px;height:600px;margin:0px auto;"> 
  <script type="text/javascript">
	//将cmp放在一个固定容器里，便于后面设置位置，必须把cmp垫底，即设置wmode="opaque"
	CMP.write("cmp", "100%", "100%", "http://cmp.cenfun.com/cmp4/cmp.swf", "skin_id=0&api=cmp_loaded&lists=", {wmode:"opaque"});
  </script> 
</div>
<div style="margin:10px auto;text-align:left;width:800px;">
  <div>名称：
    <input id="music_label" type="text" value="凤凰卫视" onclick="this.select();" />
    类型：
    <select id="music_type">
      <option value="">自动识别</option>
      <option value="1">MP3音频</option>
      <option value="2">FLV视频</option>
      <option value="3" selected="selected">WMP类型</option>
      <option value="4">动画图片</option>
    </select>
  </div>
  <div style="margin:5px 0px;">地址：
    <input id="music_src" type="text" style="width:630px;" onclick="this.select();" value="mms://222.77.190.24:9090/fhzw" />
    wma/wmv/h264</div>
  <div>
    <input type="button" value="添加到列表进行播放" onclick="addToList();" />
  </div>
</div>
<script type="text/javascript">
var cmpo,wmpo;
function cmp_loaded(key) {
	//获取cmp对象
	cmpo = CMP.get("cmp");
	if (!cmpo) {
		return;	
	}
	cmpo.addEventListener("model_start", "startHandler");
	cmpo.addEventListener("model_state", "stateHandler");
	//全屏按钮点击时侦听事件
	cmpo.addEventListener("view_fullscreen", "fsHandler");
	
	
	//添加一个测试列表
	//===============================================================================================================================================
	var xml = '<list><m type="wmp" label="WMP类型，在wmp中播放" src="http://cmp.cenfun.com/cmp4/music/test.mp3" /><m label="MP3类型，在cmp中播放" src="music/test.mp3" /></list>';
	cmpo.list_xml(xml);
	//===============================================================================================================================================
	
	
	//取得wmp对象，并添加到cmp所在容器
	wmpo = document.getElementById("WMP_" + key);
	cmpo.parentNode.appendChild(wmpo);
	//隐藏wmp控制面板等，仅显示视频窗
	wmpo.uiMode = "None";
	wmpo.fullScreen = false;
	wmpo.stretchToFit = true;
	wmpo.enableContextMenu = false;
	wmpo.style.position = "absolute";
	showWmp(false);
}
function showWmp(display) {
	if (wmpo) {
		wmpo.style.visibility = display ? "visible" : "hidden";
		//移动到视频窗口的位置
		var top = 0;
		var left = 0;
		if (!cmpo.config().video_max) {
			top = parseInt(cmpo.skin("media", "y")) + parseInt(cmpo.skin("media.video", "y"));
			left = parseInt(cmpo.skin("media", "x")) + parseInt(cmpo.skin("media.video", "x"));
		}
		wmpo.style.top = top + "px";
		wmpo.style.left = left + "px";
		//设置wmp的宽高和cmp里的视频宽高一样
		wmpo.width = cmpo.config().video_width;
		wmpo.height = cmpo.config().video_height;
		//锁定窗口，防止拖动时，wmp的视频会错位
		cmpo.skin("console", "lock", display);
	}
}
function startHandler(data) {
	var item = cmpo.item();
	var iswmp = false;
	//当前项是否为wmp类型
	if (item.type == "wmp") {
		iswmp = true;
	}
	showWmp(iswmp);
	cmpo.allowFullScreen = !iswmp;
	cmpo.config("fullscreen", iswmp);
}
function stateHandler(data) {
	//播放状态为完成或停止时，隐藏wmp
	if (data == "completed" || data == "stopped") {
		showWmp(false);
	}
}
function fsHandler(data) {
	//设置wmp全屏
	var item = cmpo.item();
	if (item.type == "wmp") {
		wmpo.fullScreen = true;
	}
}

function $(id) { return document.getElementById(id); }
function addToList() {
	var label = $("music_label").value;
	var type = $("music_type").value;
	var src = $("music_src").value;
	var xml = '<list><m type="'+type+'" label="'+label+'" src="'+src+'" /></list>';
	if (cmpo) {
		cmpo.list_xml(xml);
		//发送播放事件
		cmpo.sendEvent("view_play", cmpo.list().length);
	}
}
</script>
</body>
</html>